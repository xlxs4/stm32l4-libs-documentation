<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32L4xx_HAL_Driver: AES extended processing functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM32L4xx_HAL_Driver
   &#160;<span id="projectnumber">1.14.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__CRYPEx__Exported__Functions__Group2.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">AES extended processing functions<div class="ingroups"><a class="el" href="group__STM32L4xx__HAL__Driver.html">STM32L4xx_HAL_Driver</a> &raquo; <a class="el" href="group__CRYPEx.html">CRYPEx</a> &raquo; <a class="el" href="group__CRYPEx__Exported__Functions.html">CRYPEx Exported Functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Extended processing functions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaea245b1cce8e0865ab9e0a83a4f3535d"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#gaea245b1cce8e0865ab9e0a83a4f3535d">HAL_CRYPEx_AES</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint16_t Size, uint8_t *pOutputData, uint32_t Timeout)</td></tr>
<tr class="memdesc:gaea245b1cce8e0865ab9e0a83a4f3535d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in polling mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields, all operating modes (encryption, key derivation and/or decryption) and chaining modes ECB, CBC and CTR are managed by this function in polling mode.  <a href="group__CRYPEx__Exported__Functions__Group2.html#gaea245b1cce8e0865ab9e0a83a4f3535d">More...</a><br /></td></tr>
<tr class="separator:gaea245b1cce8e0865ab9e0a83a4f3535d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga801e9251413900bf2c7c1f879063bf74"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#ga801e9251413900bf2c7c1f879063bf74">HAL_CRYPEx_AES_IT</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint16_t Size, uint8_t *pOutputData)</td></tr>
<tr class="memdesc:ga801e9251413900bf2c7c1f879063bf74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in interrupt mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields, all operating modes (encryption, key derivation and/or decryption) and chaining modes ECB, CBC and CTR are managed by this function in interrupt mode.  <a href="group__CRYPEx__Exported__Functions__Group2.html#ga801e9251413900bf2c7c1f879063bf74">More...</a><br /></td></tr>
<tr class="separator:ga801e9251413900bf2c7c1f879063bf74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6b4a083fe77025ea98c3454115f35864"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#ga6b4a083fe77025ea98c3454115f35864">HAL_CRYPEx_AES_DMA</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint16_t Size, uint8_t *pOutputData)</td></tr>
<tr class="memdesc:ga6b4a083fe77025ea98c3454115f35864"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in DMA mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields.  <a href="group__CRYPEx__Exported__Functions__Group2.html#ga6b4a083fe77025ea98c3454115f35864">More...</a><br /></td></tr>
<tr class="separator:ga6b4a083fe77025ea98c3454115f35864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga36ec18f257e5b6d6739ddf38021679f5"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#ga36ec18f257e5b6d6739ddf38021679f5">HAL_CRYPEx_AES_Auth</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint64_t Size, uint8_t *pOutputData, uint32_t Timeout)</td></tr>
<tr class="memdesc:ga36ec18f257e5b6d6739ddf38021679f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in polling mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields.  <a href="group__CRYPEx__Exported__Functions__Group2.html#ga36ec18f257e5b6d6739ddf38021679f5">More...</a><br /></td></tr>
<tr class="separator:ga36ec18f257e5b6d6739ddf38021679f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab253a484f66160eeee802d4b65a59785"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#gab253a484f66160eeee802d4b65a59785">HAL_CRYPEx_AES_Auth_IT</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint64_t Size, uint8_t *pOutputData)</td></tr>
<tr class="memdesc:gab253a484f66160eeee802d4b65a59785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in interrupt mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields.  <a href="group__CRYPEx__Exported__Functions__Group2.html#gab253a484f66160eeee802d4b65a59785">More...</a><br /></td></tr>
<tr class="separator:gab253a484f66160eeee802d4b65a59785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85d6b20fcd60806b1db102ad8f7f0310"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#ga85d6b20fcd60806b1db102ad8f7f0310">HAL_CRYPEx_AES_Auth_DMA</a> (<a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *hcryp, uint8_t *pInputData, uint64_t Size, uint8_t *pOutputData)</td></tr>
<tr class="memdesc:ga85d6b20fcd60806b1db102ad8f7f0310"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out in DMA mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields.  <a href="group__CRYPEx__Exported__Functions__Group2.html#ga85d6b20fcd60806b1db102ad8f7f0310">More...</a><br /></td></tr>
<tr class="separator:ga85d6b20fcd60806b1db102ad8f7f0310"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Extended processing functions. </p>
<pre class="fragment">  ==============================================================================
                      ##### AES extended processing functions #####
  ==============================================================================
    [..]  This section provides functions allowing to:
      (+) Encrypt plaintext or decrypt cipher text using AES algorithm in different chaining modes.
          Functions are generic (handles ECB, CBC and CTR and all modes) and are only differentiated
          based on the processing type. Three processing types are available:
          (++) Polling mode
          (++) Interrupt mode
          (++) DMA mode
      (+) Generate and authentication tag in addition to encrypt/decrypt a plain/cipher text using AES
          algorithm in different chaining modes.
          Functions are generic (handles GCM, GMAC, CMAC and CCM when applicable) and process only one phase
          so that steps can be skipped if so required. Functions are only differentiated based on the processing type.
          Three processing types are available:
          (++) Polling mode
          (++) Interrupt mode
          (++) DMA mode</pre> <h2 class="groupheader">Function Documentation</h2>
<a id="gaea245b1cce8e0865ab9e0a83a4f3535d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaea245b1cce8e0865ab9e0a83a4f3535d">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in polling mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields, all operating modes (encryption, key derivation and/or decryption) and chaining modes ECB, CBC and CTR are managed by this function in polling mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td>Pointer to the plain text in case of encryption or cipher text in case of decryption or key derivation+decryption. Parameter is meaningless in case of key derivation. </td></tr>
    <tr><td class="paramname">Size</td><td>Length of the input data buffer in bytes, must be a multiple of 16. Parameter is meaningless in case of key derivation. </td></tr>
    <tr><td class="paramname">pOutputData</td><td>Pointer to the cipher text in case of encryption or plain text in case of decryption/key derivation+decryption, or pointer to the derivative keys in case of key derivation only. </td></tr>
    <tr><td class="paramname">Timeout</td><td>Specify Timeout value </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l00166">166</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* Check parameters setting */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (pOutputData == NULL)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="keywordflow">if</span> ((pInputData == NULL) || (pOutputData == NULL) || (Size == 0U))</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* Call CRYP_ReadKey() API if the operating mode is set to</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">       key derivation, CRYP_ProcessData() otherwise  */</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#ga89801a5b6eaf7c5a030d23c5f89181cd">CRYP_ReadKey</a>(hcryp, pOutputData, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#ga1c7b875d05844fd4178b49d2f52c4b66">CRYP_ProcessData</a>(hcryp, pInputData, Size, pOutputData, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">/* If the state has not been set to SUSPENDED, set it to</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">       READY, otherwise keep it as it is */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> != <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06">HAL_CRYP_STATE_SUSPENDED</a>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga36ec18f257e5b6d6739ddf38021679f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga36ec18f257e5b6d6739ddf38021679f5">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES_Auth()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES_Auth </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in polling mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td><ul>
<li>pointer to payload data in GCM or CCM payload phase,</li>
<li>pointer to B0 block in CMAC header phase,</li>
<li>pointer to C block in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init, header and final phases. </li>
</ul>
</td></tr>
    <tr><td class="paramname">Size</td><td><ul>
<li>length of the input payload data buffer in bytes in GCM or CCM payload phase,</li>
<li>length of B0 block (in bytes) in CMAC header phase,</li>
<li>length of C block (in bytes) in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CCM final phase.</li>
<li>Parameter is message length in bytes in case of GCM final phase.</li>
<li>Parameter must be set to zero in case of GMAC final phase. </li>
</ul>
</td></tr>
    <tr><td class="paramname">pOutputData</td><td><ul>
<li>pointer to plain or cipher text in GCM/CCM payload phase,</li>
<li>pointer to authentication tag in GCM/GMAC/CCM/CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CMAC header phase. </li>
</ul>
</td></tr>
    <tr><td class="paramname">Timeout</td><td>Specify Timeout value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Supported operating modes are encryption and decryption, supported chaining modes are GCM, GMAC, CMAC and CCM when the latter is applicable. </dd>
<dd>
Phases are singly processed according to hcryp-&gt;Init.GCMCMACPhase so that steps in these specific chaining modes can be skipped by the user if so required. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l00432">432</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;{</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  uint32_t index             ;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  uint32_t inputaddr         ;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  uint32_t outputaddr        ;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  uint32_t tagaddr           ;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  uint64_t headerlength      ;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  uint64_t inputlength       ;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  uint64_t payloadlength     ;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  uint32_t difflength     = 0;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  uint32_t addhoc_process = 0;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">/* input/output parameters check */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;       <span class="comment">/* No processing required */</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordflow">if</span> (((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header != NULL) &amp;&amp; (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize == 0U)) ||</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header == NULL) &amp;&amp; (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize != 0U)))</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CCM)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">/* In case of CMAC or CCM (when applicable) header phase resumption, we can have pInputData = NULL and  Size = 0 */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span> (((pInputData != NULL) &amp;&amp; (Size == 0U)) || ((pInputData == NULL) &amp;&amp; (Size != 0U)))</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">if</span> (((pInputData == NULL) &amp;&amp; (Size != 0U)) || \</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          ((pInputData != NULL) &amp;&amp; (Size == 0U)) || \</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          ((pInputData != NULL) &amp;&amp; (Size != 0U) &amp;&amp; (pOutputData == NULL)))</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_FINAL_PHASE)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">if</span> (pOutputData == NULL)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC) &amp;&amp; (pInputData == NULL))</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="comment">/* Unspecified Phase */</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">/* GCM/GMAC (or CCM when applicable) init phase */</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">/* In case of init phase, the input data (Key and Initialization Vector) have</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">       already been entered during the initialization process. Therefore, the</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">       API just waits for the CCF flag to be set. */</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="comment">/* just wait for hash computation */</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="comment">/* Mark that the initialization phase is over */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">/*=======================================================*/</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">/* GCM/GMAC or (CCM / CMAC when applicable) header phase */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">/*=======================================================*/</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="comment">/* Set header phase; for GCM or GMAC, set data-byte at this point */</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH|AES_CR_DATATYPE, CRYP_HEADER_PHASE|hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_HEADER_PHASE);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="comment">/* Enable the Peripheral */</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="comment">/* in case of CMAC, enter B0 block in header phase, before the header itself. */</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="comment">/* If Size = 0 (possible case of resumption after CMAC header phase suspension),</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">         skip these steps and go directly to header buffer feeding to the HW */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC) &amp;&amp; (Size != 0U))</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        uint64_t index_test;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        inputaddr = (uint32_t)pInputData;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">for</span>(index=0U ; (index &lt; Size); index += 16U)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          <span class="comment">/* Write the Input block in the Data Input register */</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          <span class="comment">/* If the suspension flag has been raised and if the processing is not about</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">           to end, suspend processing */</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          index_test = (uint64_t)index + 16U;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a65b8ae5d0d54ab814a89d870858d0b7d">HAL_CRYP_SUSPEND</a>) &amp;&amp; (index_test &lt; Size))</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="comment">/* reset SuspendRequest */</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a8d534b591a8e12947772b100d10cb3a5">HAL_CRYP_SUSPEND_NONE</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06">HAL_CRYP_STATE_SUSPENDED</a>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a167f7557aa3c2d5606b0ddcd6ff5dde2">HAL_CRYP_PHASE_HEADER_SUSPENDED</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;           <span class="comment">/* Save current reading and writing locations of Input and Output buffers */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;           hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;           <span class="comment">/* Save the total number of bytes (B blocks + header) that remain to be</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">              processed at this point */</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;           hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a>     =  (uint32_t) (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize + Size - index_test);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;           <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        } <span class="comment">/* for(index=0; (index &lt; Size); index += 16) */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !defined(AES_CR_NPBLB) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">/* Enter header */</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      inputaddr = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">/* Local variable headerlength is a number of bytes multiple of 128 bits,</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">         remaining header data (if any) are handled after this loop */</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      headerlength =  (((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize)/16U)*16U) ;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize % 16U) != 0U)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        difflength = (uint32_t) (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize - headerlength);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">for</span>(index=0U ; index &lt; headerlength; index += 16U)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        uint64_t index_temp;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">/* Write the Input block in the Data Input register */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">/* If the suspension flag has been raised and if the processing is not about</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">         to end, suspend processing */</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        index_temp = (uint64_t)index + 16U;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a65b8ae5d0d54ab814a89d870858d0b7d">HAL_CRYP_SUSPEND</a>) &amp;&amp; (index_temp &lt; headerlength))</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          <span class="comment">/* reset SuspendRequest */</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a8d534b591a8e12947772b100d10cb3a5">HAL_CRYP_SUSPEND_NONE</a>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06">HAL_CRYP_STATE_SUSPENDED</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a167f7557aa3c2d5606b0ddcd6ff5dde2">HAL_CRYP_PHASE_HEADER_SUSPENDED</a>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;         <span class="comment">/* Save current reading and writing locations of Input and Output buffers */</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;         hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;         <span class="comment">/* Save the total number of bytes that remain to be processed at this point */</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> =  (uint32_t) (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize - index_temp);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;         <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">/* Case header length is not a multiple of 16 bytes */</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">if</span> (difflength != 0U)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="group__CRYPEx__Private__Functions.html#ga50da73eaf01607a70cd64b714f58913f">CRYP_Padding</a>(hcryp, difflength, CRYP_POLLING_ON);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84">HAL_CRYP_PHASE_HEADER_OVER</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">/* GCM (or CCM when applicable) payload phase */</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_PAYLOAD_PHASE);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="comment">/* if the header phase has been bypassed, AES must be enabled again */</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      outputaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">/* Enter payload */</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">/* Specific handling to manage payload last block size less than 128 bits */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordflow">if</span> ((Size % 16U) != 0U)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        payloadlength = (Size/16U) * 16U;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        difflength = (uint32_t) (Size - payloadlength);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        addhoc_process = 1;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        payloadlength = Size;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">/* Feed payload */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="keywordflow">for</span>(index=0U ; index &lt; payloadlength; index += 16U)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        uint64_t index_temp;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="comment">/* Write the Input block in the Data Input register */</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="comment">/* Retrieve output data: read the output block</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">           from the Data Output Register */</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        *(uint32_t*)(outputaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        outputaddr+=4U;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        *(uint32_t*)(outputaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        outputaddr+=4U;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        *(uint32_t*)(outputaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        outputaddr+=4U;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        *(uint32_t*)(outputaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        outputaddr+=4U;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="comment">/* If the suspension flag has been raised and if the processing is not about</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">         to end, suspend processing */</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        index_temp = (uint64_t)index + 16U;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a65b8ae5d0d54ab814a89d870858d0b7d">HAL_CRYP_SUSPEND</a>) &amp;&amp; (index_temp &lt; payloadlength))</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          <span class="comment">/* no flag waiting under IRQ handling */</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_ENCRYPT)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            <span class="comment">/* Ensure that Busy flag is reset */</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gaae19ac8aa41157405f1f2c7b49cbfc5a">CRYP_WaitOnBusyFlagReset</a>(hcryp, CRYP_BUSY_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;              hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;              <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;              <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="comment">/* reset SuspendRequest */</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">SuspendRequest</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a8d534b591a8e12947772b100d10cb3a5">HAL_CRYP_SUSPEND_NONE</a>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06">HAL_CRYP_STATE_SUSPENDED</a>;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a167f7557aa3c2d5606b0ddcd6ff5dde2">HAL_CRYP_PHASE_HEADER_SUSPENDED</a>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="comment">/* Save current reading and writing locations of Input and Output buffers */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> =  (uint8_t *)outputaddr;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          <span class="comment">/* Save the number of bytes that remain to be processed at this point */</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a>     =  (uint32_t) (Size - index_temp);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="comment">/* Additional processing to manage GCM(/CCM) encryption and decryption cases when</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">         payload last block size less than 128 bits */</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">if</span> (addhoc_process == 1U)</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> =  (uint8_t *)outputaddr;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="group__CRYPEx__Private__Functions.html#ga50da73eaf01607a70cd64b714f58913f">CRYP_Padding</a>(hcryp, difflength, CRYP_POLLING_ON);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      } <span class="comment">/* (addhoc_process == 1) */</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="comment">/* Mark that the payload phase is over */</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d">HAL_CRYP_PHASE_PAYLOAD_OVER</a>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">/* GCM/GMAC/CCM or CMAC final phase */</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      tagaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;     <span class="comment">/* By default, clear NPBLB field */</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga4734c37dd6682d79ce748b9bff126f66">CLEAR_BIT</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_NPBLB);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_FINAL_PHASE);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="comment">/* if the header and payload phases have been bypassed, AES must be enabled again */</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>)</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        headerlength = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize * 8U; <span class="comment">/* Header length in bits */</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        inputlength = Size * 8U;                    <span class="comment">/* input length in bits */</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_1B)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)(headerlength&gt;&gt;32));</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)headerlength);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)(inputlength&gt;&gt;32));</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)inputlength);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_8B)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(headerlength&gt;&gt;32));</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)headerlength);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(inputlength&gt;&gt;32));</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)inputlength);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_16B)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)(headerlength&gt;&gt;32), 16);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)headerlength, 16);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)(inputlength&gt;&gt;32), 16);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)inputlength, 16);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_32B)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          <span class="comment">/* Unspecified Data Type */</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;         <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="comment">/* Enter the last block made of a 128-bit value formatted</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">           from the original B0 packet. */</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;         <span class="comment">/* Unspecified Chaining Mode */</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;       }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, Timeout) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="comment">/* Read the Auth TAG in the Data Out register */</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <span class="comment">/* Mark that the final phase is over */</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a39bbf6bce20bb8baee3bac7591a61605">HAL_CRYP_PHASE_FINAL_OVER</a>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="comment">/* Disable the Peripheral */</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      __HAL_CRYP_DISABLE(hcryp);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga85d6b20fcd60806b1db102ad8f7f0310"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga85d6b20fcd60806b1db102ad8f7f0310">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES_Auth_DMA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES_Auth_DMA </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in DMA mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td><ul>
<li>pointer to payload data in GCM or CCM payload phase,</li>
<li>pointer to B0 block in CMAC header phase,</li>
<li>pointer to C block in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init, header and final phases. </li>
</ul>
</td></tr>
    <tr><td class="paramname">Size</td><td><ul>
<li>length of the input payload data buffer in bytes in GCM or CCM payload phase,</li>
<li>length of B0 block (in bytes) in CMAC header phase,</li>
<li>length of C block (in bytes) in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CCM final phase.</li>
<li>Parameter is message length in bytes in case of GCM final phase.</li>
<li>Parameter must be set to zero in case of GMAC final phase. </li>
</ul>
</td></tr>
    <tr><td class="paramname">pOutputData</td><td><ul>
<li>pointer to plain or cipher text in GCM/CCM payload phase,</li>
<li>pointer to authentication tag in GCM/GMAC/CCM/CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CMAC header phase. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Supported operating modes are encryption and decryption, supported chaining modes are GCM, GMAC and CMAC. </dd>
<dd>
Phases are singly processed according to hcryp-&gt;Init.GCMCMACPhase so that steps in these specific chaining modes can be skipped by the user if so required. </dd>
<dd>
pInputData and pOutputData buffers must be 32-bit aligned to ensure a correct DMA transfer to and from the IP. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l01403">1403</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;{</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  uint32_t inputaddr      ;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  uint32_t outputaddr     ;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  uint32_t tagaddr        ;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  uint64_t headerlength   ;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  uint64_t inputlength    ;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  uint64_t payloadlength  ;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="comment">/* input/output parameters check */</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    {</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;       <span class="comment">/* No processing required */</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header != NULL) &amp;&amp; (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize == 0U))</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CCM)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="comment">/* In case of CMAC or CCM header phase resumption, we can have pInputData = NULL and  Size = 0 */</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">if</span> (((pInputData != NULL) &amp;&amp; (Size == 0U)) || ((pInputData == NULL) &amp;&amp; (Size != 0U)))</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        {</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">if</span> ((pInputData == NULL) || (Size == 0U))</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        {</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        }</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">if</span> ((pInputData != NULL) &amp;&amp; (Size != 0U) &amp;&amp; (pOutputData == NULL))</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      {</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    }</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_FINAL_PHASE)</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">if</span> (pOutputData == NULL)</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      }</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC) &amp;&amp; (pInputData == NULL))</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      {</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      }</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    {</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="comment">/* Unspecified Phase */</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160; </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="comment">/* GCM/GMAC (or CCM when applicable) init phase */</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">/* In case of init phase, the input data (Key and Initialization Vector) have</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">       already been entered during the initialization process. No DMA transfer is</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">       required at that point therefore, the software just waits for the CCF flag</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">       to be raised. */</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    {</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">/* just wait for hash computation */</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, CRYP_CCF_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      }</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160; </div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="comment">/* Mark that the initialization phase is over */</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">/*====================================*/</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="comment">/* GCM/GMAC/ CCM or CMAC header phase */</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">/*====================================*/</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    {</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="comment">/* Set header phase; for GCM or GMAC, set data-byte at this point */</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      {</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH|AES_CR_DATATYPE, CRYP_HEADER_PHASE|hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_HEADER_PHASE);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      }</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <span class="comment">/* Enable the CRYP peripheral */</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="comment">/* enter first B0 block in polling mode (no DMA transfer for B0) */</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      {</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, CRYP_CCF_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        }</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="comment">/* No header case */</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header == NULL)</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84">HAL_CRYP_PHASE_HEADER_OVER</a>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160; </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      inputaddr = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <a class="code" href="group__LPUART__LL__EF__Configuration.html#ga3278356e8f771edc00843def4920f76c">if</a> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize % 16U) != 0U)</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160; </div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize &lt; 16U)</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;          <a class="code" href="group__CRYPEx__Private__Functions.html#ga50da73eaf01607a70cd64b714f58913f">CRYP_Padding</a>(hcryp, (uint32_t) (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize), CRYP_POLLING_OFF);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;          <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84">HAL_CRYP_PHASE_HEADER_OVER</a>;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;          <span class="comment">/* CCF flag indicating header phase AES processing completion</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">             will be checked at the start of the next phase:</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">            - payload phase (GCM / CCM when applicable)</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">            - final phase (GMAC or CMAC when applicable).  */</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;          <span class="comment">/* Local variable headerlength is a number of bytes multiple of 128 bits,</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">            remaining header data (if any) are handled after this loop */</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          headerlength =  (((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize)/16U)*16U) ;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;          <span class="comment">/* Store the ending transfer point */</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header + headerlength;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize - headerlength); <span class="comment">/* remainder */</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;          <span class="comment">/* Set the input and output addresses and start DMA transfer */</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;          <span class="comment">/* (incomplete DMA transfer, will be wrapped up after completion of</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">             the first one (initiated here) with data padding */</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;          <a class="code" href="group__CRYPEx__Private__Functions.html#ga73273db704964494745f298999b8adb8">CRYP_Authentication_SetDMAConfig</a>(hcryp, inputaddr, (uint16_t)headerlength, 0);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      }</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      {</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = 0;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="comment">/* Set the input address and start DMA transfer */</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <a class="code" href="group__CRYPEx__Private__Functions.html#ga73273db704964494745f298999b8adb8">CRYP_Authentication_SetDMAConfig</a>(hcryp, inputaddr, (uint16_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize, 0);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="comment">/* GCM (or CCM when applicable) payload phase */</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="comment">/* Coming from header phase, wait for CCF flag to be raised</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">          if header present and fed to the IP in the previous phase */</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header != NULL)</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      {</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, CRYP_CCF_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      {</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="comment">/* Enable the Peripheral since wasn&#39;t in header phase (no header case) */</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      }</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160; </div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_PAYLOAD_PHASE);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      <span class="comment">/* No payload case */</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="keywordflow">if</span> (pInputData == NULL)</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      {</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d">HAL_CRYP_PHASE_PAYLOAD_OVER</a>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160; </div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      <span class="comment">/* Specific handling to manage payload size less than 128 bits */</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      <span class="keywordflow">if</span> ((Size % 16U) != 0U)</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        outputaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="keywordflow">if</span> (Size &lt; 16U)</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        {</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;          <span class="comment">/* Block is now entered in polling mode, no actual gain in resorting to DMA */</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>  =  (uint8_t *)inputaddr;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> =  (uint8_t *)outputaddr;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160; </div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;          <a class="code" href="group__CRYPEx__Private__Functions.html#ga50da73eaf01607a70cd64b714f58913f">CRYP_Padding</a>(hcryp, (uint32_t)Size, CRYP_POLLING_ON);</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          <span class="comment">/* Change the CRYP state to ready */</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;          <span class="comment">/* Mark that the payload phase is over */</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d">HAL_CRYP_PHASE_PAYLOAD_OVER</a>;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160; </div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;          <span class="comment">/* Call output data transfer complete callback */</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="preprocessor">#if (USE_HAL_CRYP_REGISTER_CALLBACKS == 1)</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a82a47708303b5c3f93c73d0512c466c0">OutCpltCallback</a>(hcryp);</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;          <a class="code" href="group__CRYP__Exported__Functions__Group3.html#gace1d7495c569f18938beac952feda6bb">HAL_CRYP_OutCpltCallback</a>(hcryp);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_CRYP_REGISTER_CALLBACKS */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        }</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;          payloadlength = (Size/16U) * 16U;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160; </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          <span class="comment">/* Store the ending transfer points */</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = pInputData;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> += payloadlength;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> = pOutputData;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> += payloadlength;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)(Size - payloadlength); <span class="comment">/* remainder */</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;          <span class="comment">/* Set the input and output addresses and start DMA transfer */</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          <span class="comment">/* (incomplete DMA transfer, will be wrapped up with data padding</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">             after completion of the one initiated here) */</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;          <a class="code" href="group__CRYPEx__Private__Functions.html#ga73273db704964494745f298999b8adb8">CRYP_Authentication_SetDMAConfig</a>(hcryp, inputaddr, (uint16_t)payloadlength, outputaddr);</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        }</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      }</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = 0;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        outputaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="comment">/* Set the input and output addresses and start DMA transfer */</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <a class="code" href="group__CRYPEx__Private__Functions.html#ga73273db704964494745f298999b8adb8">CRYP_Authentication_SetDMAConfig</a>(hcryp, inputaddr, (uint16_t)Size, outputaddr);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    }</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="comment">/* GCM/GMAC/CCM or CMAC final phase */</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      <span class="comment">/* If coming from header phase (GMAC or CMAC case when applicable),</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">         wait for CCF flag to be raised */</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      <span class="keywordflow">if</span> (READ_BIT(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH) == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      {</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, CRYP_CCF_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        }</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      }</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160; </div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      tagaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;     <span class="comment">/* By default, clear NPBLB field */</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga4734c37dd6682d79ce748b9bff126f66">CLEAR_BIT</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_NPBLB);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_FINAL_PHASE);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160; </div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="comment">/* if the header and payload phases have been bypassed, AES must be enabled again */</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>)</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        headerlength = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize * 8U; <span class="comment">/* Header length in bits */</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        inputlength = Size * 8U;  <span class="comment">/* input length in bits */</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="comment">/* Write the number of bits in the header on 64 bits followed by the number</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">           of bits in the payload on 64 bits as well */</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_1B)</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        {</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)(headerlength&gt;&gt;32));</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)headerlength);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)(inputlength&gt;&gt;32));</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)inputlength);</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_8B)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(headerlength&gt;&gt;32));</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)headerlength);</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(inputlength&gt;&gt;32));</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)inputlength);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        }</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_16B)</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)(headerlength&gt;&gt;32), 16);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)headerlength, 16);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)(inputlength&gt;&gt;32), 16);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)inputlength, 16);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        }</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_32B)</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        {</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;          <span class="comment">/* Unspecified Data Type */</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        }</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      {</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="comment">/* Enter the last block made of a 128-bit value formatted</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">           from the original B0 packet. */</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <span class="comment">/* Unspecified Chaining Mode */</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160; </div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="comment">/* No DMA transfer is required at that point therefore, the software</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">         just waits for the CCF flag to be raised. */</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a>(hcryp, CRYP_CCF_TIMEOUTVALUE) != <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>)</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      {</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;          <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;          <span class="keywordflow">return</span> HAL_TIMEOUT;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      <span class="comment">/* Read the Auth TAG in the IN FIFO */</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      tagaddr+=4U;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      *(uint32_t*)(tagaddr) = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DOUTR;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160; </div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="comment">/* Clear CCF Flag */</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      __HAL_CRYP_CLEAR_FLAG(hcryp, CRYP_CCF_CLEAR);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160; </div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      <span class="comment">/* Mark that the final phase is over */</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a39bbf6bce20bb8baee3bac7591a61605">HAL_CRYP_PHASE_FINAL_OVER</a>;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <span class="comment">/* Disable the Peripheral */</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      __HAL_CRYP_DISABLE(hcryp);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160; </div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160; </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  }</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  {</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  }</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="gab253a484f66160eeee802d4b65a59785"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab253a484f66160eeee802d4b65a59785">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES_Auth_IT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES_Auth_IT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in interrupt mode the authentication tag generation as well as the ciphering or deciphering operation according to hcryp-&gt;Init structure fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td><ul>
<li>pointer to payload data in GCM or CCM payload phase,</li>
<li>pointer to B0 block in CMAC header phase,</li>
<li>pointer to C block in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init, header and final phases. </li>
</ul>
</td></tr>
    <tr><td class="paramname">Size</td><td><ul>
<li>length of the input payload data buffer in bytes in GCM or CCM payload phase,</li>
<li>length of B0 block (in bytes) in CMAC header phase,</li>
<li>length of C block (in bytes) in CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CCM final phase.</li>
<li>Parameter is message length in bytes in case of GCM final phase.</li>
<li>Parameter must be set to zero in case of GMAC final phase. </li>
</ul>
</td></tr>
    <tr><td class="paramname">pOutputData</td><td><ul>
<li>pointer to plain or cipher text in GCM/CCM payload phase,</li>
<li>pointer to authentication tag in GCM/GMAC/CCM/CMAC final phase.</li>
<li>Parameter is meaningless in case of GCM/GMAC/CCM init and header phases.</li>
<li>Parameter is meaningless in case of CMAC header phase. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Supported operating modes are encryption and decryption, supported chaining modes are GCM, GMAC and CMAC. </dd>
<dd>
Phases are singly processed according to hcryp-&gt;Init.GCMCMACPhase so that steps in these specific chaining modes can be skipped by the user if so required. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l00943">943</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;{</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  uint32_t inputaddr         ;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  uint64_t headerlength      ;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  uint64_t inputlength       ;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  uint32_t index             ;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  uint32_t addhoc_process = 0;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  uint32_t difflength     = 0;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  uint32_t difflengthmod4 = 0;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  uint32_t mask[4][3];</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  uint32_t mask_index = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType &gt;&gt; AES_CR_DATATYPE_Pos;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  mask[0][0] = 0xFF000000U;  mask[0][1] = 0xFFFF0000U;  mask[0][2] = 0xFFFFFF00U;  <span class="comment">/* 32-bit data */</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  mask[1][0] = 0x0000FF00U;  mask[1][1] = 0x0000FFFFU;  mask[1][2] = 0xFF00FFFFU;  <span class="comment">/* 16-bit data */</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  mask[2][0] = 0x000000FFU;  mask[2][1] = 0x0000FFFFU;  mask[2][2] = 0x00FFFFFFU;  <span class="comment">/* 8-bit data  */</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  mask[3][0] = 0x000000FFU;  mask[3][1] = 0x0000FFFFU;  mask[3][2] = 0x00FFFFFFU;  <span class="comment">/* Bit data    */</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">/* input/output parameters check */</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;       <span class="comment">/* No processing required */</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keywordflow">if</span> (((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header != NULL) &amp;&amp; (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize == 0U)) ||</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;          ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header == NULL) &amp;&amp; (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize != 0U)))</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      }</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CCM)</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="comment">/* In case of CMAC or CCM header phase resumption, we can have pInputData = NULL and  Size = 0 */</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">if</span> (((pInputData != NULL) &amp;&amp; (Size == 0U)) || ((pInputData == NULL) &amp;&amp; (Size != 0U)))</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        }</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    }</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> ((pInputData != NULL) &amp;&amp; (Size != 0U) &amp;&amp; (pOutputData == NULL))</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_FINAL_PHASE)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">if</span> (pOutputData == NULL)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">if</span> ((hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC) &amp;&amp; (pInputData == NULL))</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="comment">/* Unspecified Phase */</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;     }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="comment">/* Enable Computation Complete Flag and Error Interrupts */</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    __HAL_CRYP_ENABLE_IT(hcryp, CRYP_IT_CCFIE|CRYP_IT_ERRIE);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="comment">/* GCM/GMAC (or CCM when applicable) init phase */</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">/*==============================================*/</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_INIT_PHASE)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    {</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="comment">/* In case of init phase, the input data (Key and Initialization Vector) have</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">       already been entered during the initialization process. Therefore, the</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">       software just waits for the CCF interrupt to be raised and which will</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">       be handled by CRYP_AES_Auth_IT() API. */</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">/*===================================*/</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="comment">/* GCM/GMAC/CCM or CMAC header phase */</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">/*===================================*/</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_HEADER_PHASE)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CCM)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="comment">/* In case of CMAC, B blocks are first entered, before the header.</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">           Therefore, B blocks and the header are entered back-to-back</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">           as if it was only one single block.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">           However, in case of resumption after suspension, if all the</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">           B blocks have been entered (in that case, Size = 0), only the</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">           remainder of the non-processed header bytes are entered. */</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;          <span class="keywordflow">if</span> (Size != 0U)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;          {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)(Size + hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = pInputData;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      {</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="comment">/* Get the header addresses and sizes */</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      inputaddr = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;#<span class="keywordflow">if</span> !defined(AES_CR_NPBLB)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="comment">/* Set header phase; for GCM or GMAC, set data-byte at this point */</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH|AES_CR_DATATYPE, CRYP_HEADER_PHASE|hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_HEADER_PHASE);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <span class="comment">/* Enable the Peripheral */</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="comment">/* Increment/decrement instance pointer/counter */</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> == 0U)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="comment">/* Case of no header */</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84">HAL_CRYP_PHASE_HEADER_OVER</a>;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> &lt; 16U)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = 0;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        addhoc_process = 1;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        difflength = (uint32_t) (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        difflengthmod4 = difflength%4U;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> += 16;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> -= 16U;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CCM)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> == hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        {</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          <span class="comment">/* All B blocks will have been entered after the next</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">             four DINR writing, so point at header buffer for</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">             the next iteration */</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.Header;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="comment">/* Enter header first block to initiate the process</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">         in the Data Input register */</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">if</span> (addhoc_process == 0U)</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="comment">/* Header has size equal or larger than 128 bits */</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="comment">/* Header has size less than 128 bits */</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="comment">/* Enter complete words when possible */</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">for</span>(index=0U ; index &lt; (difflength/4U); index ++)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        {</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          <span class="comment">/* Write the Input block in the Data Input register */</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="comment">/* Enter incomplete word padded with zeroes if applicable</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">          (case of header length not a multiple of 32-bits) */</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">if</span> (difflengthmod4 != 0U)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = ((*(uint32_t*)(inputaddr)) &amp; mask[mask_index][difflengthmod4-1U]);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="comment">/* Pad with zero-words to reach 128-bit long block and wrap-up header feeding to the IP */</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">for</span>(index=0U; index &lt; (4U - ((difflength+3U)/4U)); index ++)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = 0;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    }</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">/* GCM (or CCM when applicable) payload phase */</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="comment">/*============================================*/</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.GCMCMACPhase == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">/* Get the buffer addresses and sizes */</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = (uint32_t)Size;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = pInputData;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> = pOutputData;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a5f50c39c14a76526dcac75bf3d7bd93f">CrypOutCount</a> = (uint32_t)Size;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      inputaddr = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_PAYLOAD_PHASE);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="comment">/* if the header phase has been bypassed, AES must be enabled again */</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>)</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="comment">/* No payload case */</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">if</span> (pInputData == NULL)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="comment">/* Mark that the header phase is over */</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d">HAL_CRYP_PHASE_PAYLOAD_OVER</a>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;     <span class="comment">/* Specific handling to manage payload size less than 128 bits */</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">if</span> (Size &lt; 16U)</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        difflength = (uint32_t) (Size);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="comment">/* In case of GCM encryption or CCM decryption, specify the number of padding</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">           bytes in last block of payload */</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">if</span> (READ_BIT(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH) == CRYP_PAYLOAD_PHASE)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          uint32_t cr_temp = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          <span class="keywordflow">if</span> (((cr_temp &amp; (AES_CR_CHMOD|AES_CR_MODE)) == (CRYP_CHAINMODE_AES_GCM_GMAC|CRYP_ALGOMODE_ENCRYPT))</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;           ||  ((cr_temp &amp; (AES_CR_CHMOD|AES_CR_MODE)) == (CRYP_CHAINMODE_AES_CCM|CRYP_ALGOMODE_DECRYPT)))</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            <span class="comment">/* Set NPBLB field in writing the number of padding bytes</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">               for the last block of payload */</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_NPBLB, (16U - difflength) &lt;&lt; AES_POSITION_CR_NPBLB);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="comment">/* Software workaround applied to GCM encryption only */</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_ENCRYPT)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          <span class="comment">/* Change the mode configured in CHMOD bits of CR register to select CTR mode */</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          __HAL_CRYP_SET_CHAININGMODE(hcryp, CRYP_CHAINMODE_AES_CTR);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="comment">/* Set hcryp-&gt;CrypInCount to 0 (no more data to enter) */</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = 0;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="comment">/*  Insert the last block (which size is inferior to 128 bits) padded with zeroes,</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">            to have a complete block of 128 bits */</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        difflengthmod4 = difflength%4U;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        <span class="comment">/*  Insert the last block (which size is inferior to 128 bits) padded with zeroes</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">            to have a complete block of 128 bits */</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="keywordflow">for</span>(index=0U; index &lt; (difflength/4U); index ++)</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        {</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          <span class="comment">/* Write the Input block in the Data Input register */</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;          inputaddr+=4U;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="comment">/* If required, manage input data size not multiple of 32 bits */</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="keywordflow">if</span> (difflengthmod4 != 0U)</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = ((*(uint32_t*)(inputaddr)) &amp; mask[mask_index][difflengthmod4-1U]);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        }</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="comment">/* Wrap-up in padding with zero-words if applicable */</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="keywordflow">for</span>(index=0U; index &lt; (4U - ((difflength+3U)/4U)); index ++)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = 0;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <span class="comment">/* Increment/decrement instance pointer/counter */</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> += 16;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> -= 16U;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="comment">/* Enter payload first block to initiate the process</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">           in the Data Input register */</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      }</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">/* GCM/GMAC/CCM or CMAC final phase */</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="comment">/*==================================*/</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;       hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> = pOutputData;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="preprocessor">#if defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;     <span class="comment">/* By default, clear NPBLB field */</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga4734c37dd6682d79ce748b9bff126f66">CLEAR_BIT</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_NPBLB);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;       <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;CR, AES_CR_GCMPH, CRYP_FINAL_PHASE);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="comment">/* if the header and payload phases have been bypassed, AES must be enabled again */</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">Phase</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a>)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        __HAL_CRYP_ENABLE(hcryp);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      }</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_GCM_GMAC)</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        headerlength = hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.HeaderSize * 8U; <span class="comment">/* Header length in bits */</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        inputlength = Size * 8U;                    <span class="comment">/* Input length in bits */</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="comment">/* Write the number of bits in the header on 64 bits followed by the number</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">           of bits in the payload on 64 bits as well */</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_1B)</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)((headerlength)&gt;&gt;32));</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)headerlength);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)((inputlength)&gt;&gt;32));</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __RBIT((uint32_t)inputlength);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        }</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_8B)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(headerlength&gt;&gt;32));</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)headerlength);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)(inputlength&gt;&gt;32));</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __REV((uint32_t)inputlength);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_16B)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)((headerlength)&gt;&gt;32), 16);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)headerlength, 16);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)((inputlength)&gt;&gt;32), 16);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = __ROR((uint32_t)inputlength, 16);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.DataType == CRYP_DATATYPE_32B)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        }</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          <span class="comment">/* Unspecified Data Type */</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength&gt;&gt;32);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(headerlength);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength&gt;&gt;32);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = (uint32_t)(inputlength);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      }</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="preprocessor">#if !defined(AES_CR_NPBLB)</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.ChainingMode == CRYP_CHAINMODE_AES_CMAC)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <span class="comment">/* Enter the last block made of a 128-bit value formatted</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">           from the original B0 packet. */</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        inputaddr+=4U;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="comment">/* Unspecified Chaining Mode */</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  }</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga6b4a083fe77025ea98c3454115f35864"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6b4a083fe77025ea98c3454115f35864">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES_DMA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES_DMA </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in DMA mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td>Pointer to the plain text in case of encryption or cipher text in case of decryption or key derivation+decryption. </td></tr>
    <tr><td class="paramname">Size</td><td>Length of the input data buffer in bytes, must be a multiple of 16. </td></tr>
    <tr><td class="paramname">pOutputData</td><td>Pointer to the cipher text in case of encryption or plain text in case of decryption/key derivation+decryption. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Chaining modes ECB, CBC and CTR are managed by this function in DMA mode. </dd>
<dd>
Supported operating modes are encryption, decryption and key derivation with decryption. </dd>
<dd>
No DMA channel is provided for key derivation only and therefore, access to AES_KEYRx registers must be done by software. </dd>
<dd>
This API is not applicable to key derivation only; for such a mode, access to AES_KEYRx registers must be done by software thru <a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#gaea245b1cce8e0865ab9e0a83a4f3535d" title="Carry out in polling mode the ciphering or deciphering operation according to hcryp-&gt;Init structure f...">HAL_CRYPEx_AES()</a> or <a class="el" href="group__CRYPEx__Exported__Functions__Group2.html#ga801e9251413900bf2c7c1f879063bf74" title="Carry out in interrupt mode the ciphering or deciphering operation according to hcryp-&gt;Init structure...">HAL_CRYPEx_AES_IT()</a> APIs. </dd>
<dd>
pInputData and pOutputData buffers must be 32-bit aligned to ensure a correct DMA transfer to and from the IP. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l00351">351</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  uint32_t inputaddr;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  uint32_t outputaddr;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">/* Check parameters setting */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">/* no DMA channel is provided for key derivation operating mode,</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">         access to AES_KEYRx registers must be done by software */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">if</span> ((pInputData == NULL) || (pOutputData == NULL) || (Size == 0U))</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    inputaddr  = (uint32_t)pInputData;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    outputaddr = (uint32_t)pOutputData;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">/* Set the input and output addresses and start DMA transfer */</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="group__CRYPEx__Private__Functions.html#ga56a79aad9a63fa2585b1db9920b9ec9b">CRYP_SetDMAConfig</a>(hcryp, inputaddr, Size, outputaddr);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">/* Return function status */</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga801e9251413900bf2c7c1f879063bf74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga801e9251413900bf2c7c1f879063bf74">&#9670;&nbsp;</a></span>HAL_CRYPEx_AES_IT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef HAL_CRYPEx_AES_IT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stm32l4xx__hal__cryp_8h.html#af0d67c641cadb73b1b43a85f6dec5cd7">CRYP_HandleTypeDef</a> *&#160;</td>
          <td class="paramname"><em>hcryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pInputData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pOutputData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out in interrupt mode the ciphering or deciphering operation according to hcryp-&gt;Init structure fields, all operating modes (encryption, key derivation and/or decryption) and chaining modes ECB, CBC and CTR are managed by this function in interrupt mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hcryp</td><td>pointer to a CRYP_HandleTypeDef structure that contains the configuration information for CRYP module </td></tr>
    <tr><td class="paramname">pInputData</td><td>Pointer to the plain text in case of encryption or cipher text in case of decryption or key derivation+decryption. Parameter is meaningless in case of key derivation. </td></tr>
    <tr><td class="paramname">Size</td><td>Length of the input data buffer in bytes, must be a multiple of 16. Parameter is meaningless in case of key derivation. </td></tr>
    <tr><td class="paramname">pOutputData</td><td>Pointer to the cipher text in case of encryption or plain text in case of decryption/key derivation+decryption, or pointer to the derivative keys in case of key derivation only. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL</td><td>status </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html#l00246">246</a> of file <a class="el" href="stm32l4xx__hal__cryp__ex_8c_source.html">stm32l4xx_hal_cryp_ex.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  uint32_t inputaddr;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">if</span>(hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> == <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a>)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/* Check parameters setting */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode == CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (pOutputData == NULL)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">if</span> ((pInputData == NULL) || (pOutputData == NULL) || (Size == 0U))</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">return</span>  HAL_ERROR;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">/* Process Locked */</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a>(hcryp);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">/* If operating mode is not limited to key derivation only,</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">       get the buffers addresses and sizes */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode != CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> = Size;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> = pInputData;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> = pOutputData;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a5f50c39c14a76526dcac75bf3d7bd93f">CrypOutCount</a> = Size;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">/* For key derivation, set output buffer only</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">        (will point at derivated key) */</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">pCrypOutBuffPtr</a> = pOutputData;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">/* Change the CRYP state */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">State</a> = <a class="code" href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="comment">/* Process Unlocked */</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a>(hcryp);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">/* Enable Computation Complete Flag and Error Interrupts */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    __HAL_CRYP_ENABLE_IT(hcryp, CRYP_IT_CCFIE|CRYP_IT_ERRIE);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">/* If operating mode is key derivation only, the input data have</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">       already been entered during the initialization process. For</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">       the other operating modes, they are fed to the CRYP hardware</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">       block at this point. */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">Init</a>.OperatingMode != CRYP_ALGOMODE_KEYDERIVATION)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">/* Initiate the processing under interrupt in entering</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">         the first input data */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      inputaddr = (uint32_t)hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="comment">/* Increment/decrement instance pointer/counter */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">pCrypInBuffPtr</a> += 16;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">CrypInCount</a> -= 16U;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">/* Write the first input block in the Data Input register */</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      inputaddr+=4U;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      inputaddr+=4U;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR  = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      inputaddr+=4U;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      hcryp-&gt;<a class="code" href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">Instance</a>-&gt;DINR = *(uint32_t*)(inputaddr);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">/* Return function status */</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">return</span> HAL_BUSY;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__LPUART__LL__EF__Configuration_html_ga3278356e8f771edc00843def4920f76c"><div class="ttname"><a href="group__LPUART__LL__EF__Configuration.html#ga3278356e8f771edc00843def4920f76c">if</a></div><div class="ttdeci">if(lpuartdiv &gt;=LPUART_BRR_MIN_VALUE)</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__ll__lpuart_8h_source.html#l01479">stm32l4xx_ll_lpuart.h:1479</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_ae1974e6bd6aaaa031b8a47e69b3d4139a8d534b591a8e12947772b100d10cb3a5"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a8d534b591a8e12947772b100d10cb3a5">HAL_CRYP_SUSPEND_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00119">stm32l4xx_hal_cryp.h:119</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_ga1c7b875d05844fd4178b49d2f52c4b66"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#ga1c7b875d05844fd4178b49d2f52c4b66">CRYP_ProcessData</a></div><div class="ttdeci">static HAL_StatusTypeDef CRYP_ProcessData(CRYP_HandleTypeDef *hcryp, uint8_t *Input, uint16_t Ilength, uint8_t *Output, uint32_t Timeout)</div><div class="ttdoc">Write/read input/output data in polling mode.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02780">stm32l4xx_hal_cryp_ex.c:2780</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca18f135bfce961f3f1ec93df0dfb7e6e5">HAL_CRYP_STATE_READY</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00089">stm32l4xx_hal_cryp.h:89</a></div></div>
<div class="ttc" id="agroup__RTCEx__Exported__Functions__Group2_html_ga4734c37dd6682d79ce748b9bff126f66"><div class="ttname"><a href="group__RTCEx__Exported__Functions__Group2.html#ga4734c37dd6682d79ce748b9bff126f66">CLEAR_BIT</a></div><div class="ttdeci">CLEAR_BIT(hrtc-&gt;Instance-&gt;CR, RTC_CR_WUTE)</div></div>
<div class="ttc" id="agroup__RTCEx__Exported__Functions__Group2_html_ga3feac430acb1b5e74ad139639f3af9ca"><div class="ttname"><a href="group__RTCEx__Exported__Functions__Group2.html#ga3feac430acb1b5e74ad139639f3af9ca">__HAL_UNLOCK</a></div><div class="ttdeci">__HAL_UNLOCK(hrtc)</div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_af120ce17f92c3ea2e99bd35c16119cc9"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#af120ce17f92c3ea2e99bd35c16119cc9">__CRYP_HandleTypeDef::SuspendRequest</a></div><div class="ttdeci">HAL_SuspendTypeDef SuspendRequest</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00184">stm32l4xx_hal_cryp.h:184</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a82a47708303b5c3f93c73d0512c466c0"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a82a47708303b5c3f93c73d0512c466c0">__CRYP_HandleTypeDef::OutCpltCallback</a></div><div class="ttdeci">void(* OutCpltCallback)(struct __CRYP_HandleTypeDef *hcryp)</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00189">stm32l4xx_hal_cryp.h:189</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af66a5588e5799bb21e696394d365775d">HAL_CRYP_PHASE_PAYLOAD_OVER</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00107">stm32l4xx_hal_cryp.h:107</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a0af23dbd1927e0481eb965dee3e43374"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a0af23dbd1927e0481eb965dee3e43374">__CRYP_HandleTypeDef::State</a></div><div class="ttdeci">__IO HAL_CRYP_STATETypeDef State</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00180">stm32l4xx_hal_cryp.h:180</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdcac19cb6e41bfab30254254575119572b0">HAL_CRYP_STATE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00090">stm32l4xx_hal_cryp.h:90</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a5f50c39c14a76526dcac75bf3d7bd93f"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a5f50c39c14a76526dcac75bf3d7bd93f">__CRYP_HandleTypeDef::CrypOutCount</a></div><div class="ttdeci">uint32_t CrypOutCount</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00167">stm32l4xx_hal_cryp.h:167</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a3b29b06cf98ae295b8d13695185f385a"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a3b29b06cf98ae295b8d13695185f385a">__CRYP_HandleTypeDef::Phase</a></div><div class="ttdeci">HAL_PhaseTypeDef Phase</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00169">stm32l4xx_hal_cryp.h:169</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84aa181131d9fb8ae64ad2f9999c641ffc1">HAL_CRYP_PHASE_INIT_OVER</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00105">stm32l4xx_hal_cryp.h:105</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_aef3e10b2dd19fd3f896bc9b884686e84a39bbf6bce20bb8baee3bac7591a61605"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a39bbf6bce20bb8baee3bac7591a61605">HAL_CRYP_PHASE_FINAL_OVER</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00108">stm32l4xx_hal_cryp.h:108</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_ga56a79aad9a63fa2585b1db9920b9ec9b"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#ga56a79aad9a63fa2585b1db9920b9ec9b">CRYP_SetDMAConfig</a></div><div class="ttdeci">static void CRYP_SetDMAConfig(CRYP_HandleTypeDef *hcryp, uint32_t inputaddr, uint16_t Size, uint32_t outputaddr)</div><div class="ttdoc">Set the DMA configuration and start the DMA transfer.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02908">stm32l4xx_hal_cryp_ex.c:2908</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_ab5597c72952ae0b0e88e387fde7fa383"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#ab5597c72952ae0b0e88e387fde7fa383">__CRYP_HandleTypeDef::Init</a></div><div class="ttdeci">CRYP_InitTypeDef Init</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00158">stm32l4xx_hal_cryp.h:158</a></div></div>
<div class="ttc" id="agroup__CRYP__Exported__Functions__Group3_html_gace1d7495c569f18938beac952feda6bb"><div class="ttname"><a href="group__CRYP__Exported__Functions__Group3.html#gace1d7495c569f18938beac952feda6bb">HAL_CRYP_OutCpltCallback</a></div><div class="ttdeci">void HAL_CRYP_OutCpltCallback(CRYP_HandleTypeDef *hcryp)</div><div class="ttdoc">Output DMA transfer complete callback.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8c_source.html#l01155">stm32l4xx_hal_cryp.c:1155</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_ga89801a5b6eaf7c5a030d23c5f89181cd"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#ga89801a5b6eaf7c5a030d23c5f89181cd">CRYP_ReadKey</a></div><div class="ttdeci">static HAL_StatusTypeDef CRYP_ReadKey(CRYP_HandleTypeDef *hcryp, uint8_t *Output, uint32_t Timeout)</div><div class="ttdoc">Read derivative key in polling mode when CRYP hardware block is set in key derivation operating mode ...</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02859">stm32l4xx_hal_cryp_ex.c:2859</a></div></div>
<div class="ttc" id="agroup__RTCEx__Exported__Functions__Group2_html_ga05dcbf41f5c5e42a592e9ad9e351391e"><div class="ttname"><a href="group__RTCEx__Exported__Functions__Group2.html#ga05dcbf41f5c5e42a592e9ad9e351391e">HAL_OK</a></div><div class="ttdeci">return HAL_OK</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__rtc__ex_8c_source.html#l00885">stm32l4xx_hal_rtc_ex.c:885</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_ad55cfa19042d1ece3480c7717e6a20a5"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#ad55cfa19042d1ece3480c7717e6a20a5">__CRYP_HandleTypeDef::pCrypOutBuffPtr</a></div><div class="ttdeci">uint8_t * pCrypOutBuffPtr</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00162">stm32l4xx_hal_cryp.h:162</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a23c57a60471a41e90e736b49d5bbb2ce"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a23c57a60471a41e90e736b49d5bbb2ce">__CRYP_HandleTypeDef::pCrypInBuffPtr</a></div><div class="ttdeci">uint8_t * pCrypInBuffPtr</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00160">stm32l4xx_hal_cryp.h:160</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_gaae19ac8aa41157405f1f2c7b49cbfc5a"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#gaae19ac8aa41157405f1f2c7b49cbfc5a">CRYP_WaitOnBusyFlagReset</a></div><div class="ttdeci">static HAL_StatusTypeDef CRYP_WaitOnBusyFlagReset(CRYP_HandleTypeDef const *const hcryp, uint32_t Timeout)</div><div class="ttdoc">Wait for Busy Flag to be reset during a GCM payload encryption process suspension.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02983">stm32l4xx_hal_cryp_ex.c:2983</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_aedf835708ce4b2eff8998e7bb11db8fa"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#aedf835708ce4b2eff8998e7bb11db8fa">__CRYP_HandleTypeDef::CrypInCount</a></div><div class="ttdeci">uint32_t CrypInCount</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00164">stm32l4xx_hal_cryp.h:164</a></div></div>
<div class="ttc" id="astruct____CRYP__HandleTypeDef_html_a8877883b562642788d2a266a6212a309"><div class="ttname"><a href="struct____CRYP__HandleTypeDef.html#a8877883b562642788d2a266a6212a309">__CRYP_HandleTypeDef::Instance</a></div><div class="ttdeci">AES_TypeDef * Instance</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00156">stm32l4xx_hal_cryp.h:156</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84af46718070a4dd619aabe7a42cb712c84">HAL_CRYP_PHASE_HEADER_OVER</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00106">stm32l4xx_hal_cryp.h:106</a></div></div>
<div class="ttc" id="agroup__RTCEx__Exported__Functions__Group2_html_gaf0bea6a9989d50f8ffa9b2afc911fc4b"><div class="ttname"><a href="group__RTCEx__Exported__Functions__Group2.html#gaf0bea6a9989d50f8ffa9b2afc911fc4b">MODIFY_REG</a></div><div class="ttdeci">MODIFY_REG(hrtc-&gt;Instance-&gt;CR, RTC_CR_WUCKSEL,(uint32_t) WakeUpClock)</div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_aef3e10b2dd19fd3f896bc9b884686e84a167f7557aa3c2d5606b0ddcd6ff5dde2"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#aef3e10b2dd19fd3f896bc9b884686e84a167f7557aa3c2d5606b0ddcd6ff5dde2">HAL_CRYP_PHASE_HEADER_SUSPENDED</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00109">stm32l4xx_hal_cryp.h:109</a></div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#acc704e095b831d0fd637ca2d6e8d9bdca79d1090d23cd8e21db1895145be94c06">HAL_CRYP_STATE_SUSPENDED</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00093">stm32l4xx_hal_cryp.h:93</a></div></div>
<div class="ttc" id="agroup__RTCEx__Exported__Functions__Group2_html_ga88b8891e30e4b1c54fecb1235c95870d"><div class="ttname"><a href="group__RTCEx__Exported__Functions__Group2.html#ga88b8891e30e4b1c54fecb1235c95870d">__HAL_LOCK</a></div><div class="ttdeci">__HAL_LOCK(hrtc)</div></div>
<div class="ttc" id="astm32l4xx__hal__cryp_8h_html_ae1974e6bd6aaaa031b8a47e69b3d4139a65b8ae5d0d54ab814a89d870858d0b7d"><div class="ttname"><a href="stm32l4xx__hal__cryp_8h.html#ae1974e6bd6aaaa031b8a47e69b3d4139a65b8ae5d0d54ab814a89d870858d0b7d">HAL_CRYP_SUSPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp_8h_source.html#l00120">stm32l4xx_hal_cryp.h:120</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_ga50da73eaf01607a70cd64b714f58913f"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#ga50da73eaf01607a70cd64b714f58913f">CRYP_Padding</a></div><div class="ttdeci">static void CRYP_Padding(CRYP_HandleTypeDef *hcryp, uint32_t difflength, uint32_t polling)</div><div class="ttdoc">Last header or payload block padding when size is not a multiple of 128 bits.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l03083">stm32l4xx_hal_cryp_ex.c:3083</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_ga73273db704964494745f298999b8adb8"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#ga73273db704964494745f298999b8adb8">CRYP_Authentication_SetDMAConfig</a></div><div class="ttdeci">static void CRYP_Authentication_SetDMAConfig(CRYP_HandleTypeDef *hcryp, uint32_t inputaddr, uint16_t Size, uint32_t outputaddr)</div><div class="ttdoc">Set the DMA configuration and start the DMA transfer for GCM, GMAC, CCM or CMAC chaining modes.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02718">stm32l4xx_hal_cryp_ex.c:2718</a></div></div>
<div class="ttc" id="agroup__CRYPEx__Private__Functions_html_gabfbc3ffed5531a655d8ddb0c99f37b45"><div class="ttname"><a href="group__CRYPEx__Private__Functions.html#gabfbc3ffed5531a655d8ddb0c99f37b45">CRYP_WaitOnCCFlag</a></div><div class="ttdeci">static HAL_StatusTypeDef CRYP_WaitOnCCFlag(CRYP_HandleTypeDef const *const hcryp, uint32_t Timeout)</div><div class="ttdoc">Handle CRYP hardware block Timeout when waiting for CCF flag to be raised.</div><div class="ttdef"><b>Definition:</b> <a href="stm32l4xx__hal__cryp__ex_8c_source.html#l02955">stm32l4xx_hal_cryp_ex.c:2955</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
